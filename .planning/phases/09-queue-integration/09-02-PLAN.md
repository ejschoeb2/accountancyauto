---
phase: 09-queue-integration
plan: 02
type: execute
wave: 2
depends_on: ["09-01"]
files_modified:
  - app/api/templates/route.ts
  - app/api/templates/[id]/route.ts
  - app/api/clients/[id]/template-overrides/route.ts
  - app/(dashboard)/clients/[id]/components/template-overrides.tsx
  - app/(dashboard)/clients/[id]/page.tsx
  - lib/templates/inheritance.ts
  - lib/templates/inheritance.test.ts
  - lib/validations/template.ts
  - lib/types/database.ts
  - scripts/verify-migration.ts
  - supabase/migrations/20260208100002_drop_reminder_templates.sql
autonomous: true

must_haves:
  truths:
    - "No source file in app/ or lib/ references the reminder_templates table"
    - "No source file imports from lib/templates/inheritance"
    - "Old /api/templates routes are deleted"
    - "Old template-overrides API route and component are deleted"
    - "reminder_templates table is dropped via migration"
    - "Client detail page renders without errors after template-overrides removal"
    - "Application builds successfully with no TypeScript errors"
  artifacts:
    - path: "supabase/migrations/20260208100002_drop_reminder_templates.sql"
      provides: "DROP TABLE migration for reminder_templates"
      contains: "DROP TABLE"
  key_links:
    - from: "app/(dashboard)/clients/[id]/page.tsx"
      to: "no template-overrides import"
      via: "import removal"
      pattern: "template-overrides"
---

<objective>
Remove all v1.0 code references to the old reminder_templates table: delete old API routes, delete template-overrides UI components, remove the inheritance library, clean up types, delete the verify-migration script, and drop the reminder_templates table via a separate migration.

Purpose: Completes the v1.1 migration by removing all dead code paths to the old JSONB-embedded template structure. This is the "clean break" the user requested -- git history serves as reference for old code.

Output: Deleted files, cleaned types, DROP TABLE migration, and a fully audited codebase with zero references to reminder_templates in application code.
</objective>

<execution_context>
@C:\Users\ejsch\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\ejsch\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@.planning/phases/09-queue-integration/09-01-SUMMARY.md
@app/(dashboard)/clients/[id]/page.tsx
@lib/types/database.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Delete old v1.0 routes, components, and library files</name>
  <files>
    app/api/templates/route.ts (DELETE)
    app/api/templates/[id]/route.ts (DELETE)
    app/api/clients/[id]/template-overrides/route.ts (DELETE)
    app/(dashboard)/clients/[id]/components/template-overrides.tsx (DELETE)
    app/(dashboard)/clients/[id]/page.tsx
    lib/templates/inheritance.ts (DELETE)
    lib/templates/inheritance.test.ts (DELETE)
    lib/validations/template.ts (DELETE)
    scripts/verify-migration.ts (DELETE)
  </files>
  <action>
    **Delete these files entirely** (they only serve the old reminder_templates system):
    1. `app/api/templates/route.ts` -- v1.0 /api/templates GET/POST (replaced by /api/email-templates)
    2. `app/api/templates/[id]/route.ts` -- v1.0 /api/templates/[id] GET/PUT/DELETE (replaced by /api/email-templates/[id])
    3. `app/api/clients/[id]/template-overrides/route.ts` -- v1.0 template overrides API (overrides no longer used per user decision)
    4. `app/(dashboard)/clients/[id]/components/template-overrides.tsx` -- v1.0 template overrides UI component
    5. `lib/templates/inheritance.ts` -- resolveTemplateForClient() and getOverriddenFieldNames() (overrides no longer used)
    6. `lib/templates/inheritance.test.ts` -- tests for inheritance (no longer relevant)
    7. `lib/validations/template.ts` -- templateSchema and templateStepSchema for old reminder_templates (v1.1 has its own validation in /api/email-templates)
    8. `scripts/verify-migration.ts` -- one-time migration verification (migration is verified and complete)

    Also delete the empty directories after file removal:
    - `app/api/templates/[id]/` (directory)
    - `app/api/templates/` (directory)
    - `app/api/clients/[id]/template-overrides/` (directory)

    **Update client detail page** (`app/(dashboard)/clients/[id]/page.tsx`):
    - Remove the import: `import { TemplateOverrides } from './components/template-overrides';`
    - Remove the `<TemplateOverrides clientId={id} />` JSX usage
    - Do NOT add any replacement -- the template overrides section is intentionally removed per user decision (no per-client overrides)

    **Clean up types** (`lib/types/database.ts`):
    - Remove the `TemplateStep` interface (was used by old reminder_templates JSONB steps)
    - Remove the `ReminderTemplate` interface (was used by old reminder_templates table)
    - Remove the `ClientTemplateOverride` interface (overrides no longer used)
    - Keep ALL v1.1 types: `EmailTemplate`, `Schedule`, `ScheduleStep`, `ClientEmailOverride`, `ClientScheduleOverride`, `TipTapDocument`, `TipTapNode`, `UrgencyLevel`
    - Keep ALL other types: `FilingType`, `FilingTypeId`, `ClientFilingAssignment`, `ClientDeadlineOverride`, `BankHoliday`, `ReminderQueueItem`, `ReminderStatus`, `PLACEHOLDER_VARIABLES`
    - Note: The `UrgencyLevel` type currently includes 'low' which was excluded by decision [07-01]. Update to: `export type UrgencyLevel = 'normal' | 'high' | 'urgent';` (remove 'low')

    **Full codebase audit**: After deleting files and updating types, search the entire codebase for any remaining references to:
    - `reminder_templates` (in .ts, .tsx files -- ignore .planning/, .md files, and migration SQL files)
    - `resolveTemplateForClient`
    - `getOverriddenFieldNames`
    - `templateSchema` (from lib/validations/template -- NOT the email template schemas which are different)
    - `TemplateStep` (the old v1.0 type -- NOT TipTap types)
    - `client_template_overrides` (the old table -- NOT client_email_overrides which is v1.1)
    - `sendReminderEmail` (should only appear in lib/email/sender.ts as a function definition, not called anywhere)

    If any unexpected references remain, remove or update them. The goal is zero references to the old system in application code.
  </action>
  <verify>
    - `npx tsc --noEmit` passes (no type errors after removing types and imports)
    - Grep for `reminder_templates` in app/ and lib/ directories returns zero matches
    - Grep for `resolveTemplateForClient` returns zero matches
    - Grep for `inheritance` in import statements returns zero matches (in app/ and lib/)
    - Grep for `templateSchema` in import statements returns zero matches (should not be imported from lib/validations/template)
    - The deleted files no longer exist on disk
    - Client detail page file has no reference to template-overrides
  </verify>
  <done>
    All v1.0 template-related code is deleted. No application source file references reminder_templates, template overrides, or the inheritance library. Types are cleaned up with old interfaces removed.
  </done>
</task>

<task type="auto">
  <name>Task 2: Drop reminder_templates table and final verification</name>
  <files>
    supabase/migrations/20260208100002_drop_reminder_templates.sql
  </files>
  <action>
    **Create DROP TABLE migration** (`supabase/migrations/20260208100002_drop_reminder_templates.sql`):
    This is a SEPARATE migration from the queue rewiring (independent rollback per user decision).

    ```sql
    -- Drop v1.0 reminder_templates table
    -- Data has been migrated to v1.1 normalized tables (schedules, schedule_steps, email_templates)
    -- Migration 20260208000002 performed the data migration
    -- All application code now reads from v1.1 tables exclusively

    -- First drop the client_template_overrides table (references reminder_templates via template_id FK)
    DROP TABLE IF EXISTS client_template_overrides;

    -- Drop the reminder_templates table
    DROP TABLE IF EXISTS reminder_templates;

    -- Also drop associated RLS policies (CASCADE handles this, but explicit for clarity)
    ```

    Important considerations:
    - `client_template_overrides` has a FK to `reminder_templates.id`, so it must be dropped first (or use CASCADE)
    - Use `IF EXISTS` for safety
    - Do NOT drop `client_email_overrides` or `client_schedule_overrides` (v1.1 tables, kept but unused per user decision)
    - Do NOT drop `client_deadline_overrides` (still used by queue builder for deadline date calculation)

    **Final build verification:**
    After creating the migration, run `npx tsc --noEmit` one final time to confirm the entire application compiles cleanly with all v1.0 code removed.
  </action>
  <verify>
    - Migration file exists at `supabase/migrations/20260208100002_drop_reminder_templates.sql`
    - Migration drops `client_template_overrides` before `reminder_templates` (FK dependency order)
    - Migration uses `IF EXISTS` for safety
    - `npx tsc --noEmit` passes
    - `npx next build` succeeds (or at minimum `tsc --noEmit` succeeds)
  </verify>
  <done>
    DROP TABLE migration created as independent rollback unit. reminder_templates and client_template_overrides tables are scheduled for removal. Application builds cleanly with zero v1.0 code references.
  </done>
</task>

</tasks>

<verification>
After both tasks complete:
1. `npx tsc --noEmit` passes with zero errors
2. Zero matches for `reminder_templates` in any .ts or .tsx file under app/ or lib/
3. Zero matches for `resolveTemplateForClient` or `getOverriddenFieldNames` anywhere
4. Zero matches for `sendReminderEmail` in any file except lib/email/sender.ts (definition only, though it may be removed too if no longer needed)
5. Files deleted: api/templates/route.ts, api/templates/[id]/route.ts, api/clients/[id]/template-overrides/route.ts, clients/[id]/components/template-overrides.tsx, lib/templates/inheritance.ts, lib/templates/inheritance.test.ts, lib/validations/template.ts, scripts/verify-migration.ts
6. Migration 20260208100002 drops client_template_overrides then reminder_templates
7. lib/types/database.ts has no TemplateStep, ReminderTemplate, or ClientTemplateOverride interfaces
</verification>

<success_criteria>
All v1.0 reminder template code is removed from the codebase. The reminder_templates and client_template_overrides tables are dropped via migration. The application compiles and builds successfully. The codebase exclusively uses v1.1 normalized tables for all reminder functionality.
</success_criteria>

<output>
After completion, create `.planning/phases/09-queue-integration/09-02-SUMMARY.md`
</output>
